<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        list-style: none;
    }
    
    #map {
        position: relative;
        width: 800px;
        height: 500px;
        background-color: rgb(240, 234, 234);
    }
</style>

<body>
    <div id="map"></div>
    <script>
        // 创建随机对象
        var tools = {
            data: function(min, max) {
                return Math.floor(Math.random() * (max - min + 1) + min)
            }
        };
        (function() {
            let map = document.getElementById('map');
            // 食物对象构造函数
            function Foot(options) {
                options = options || {}
                this.width = options.width || 20
                this.height = options.height || 20
                    // this.x = options.x || 0
                    // this.y = options.y || 0
                this.color = options.color || 'yellow'
                this.div = document.createElement('div')
                map.appendChild(this.div)
            }
            Foot.prototype.init = function() {
                div = this.div
                x = tools.data(0, 39)
                y = tools.data(0, 24)
                div.style.position = 'absolute'
                div.style.width = this.width + 'px'
                div.style.height = this.height + 'px'
                div.style.left = x * 20 + 'px'
                div.style.top = y * 20 + 'px'
                div.style.backgroundColor = this.color
            }
            window.Foot = Foot;
        })();
        (function() {
            //    创建蛇对象
            function Snake(options) {
                map = document.getElementById('map');

                options = options || {}
                    // 蛇节宽高
                this.d = 'right'

                this.width = options.width || 20
                this.height = options.height || 20
                this.body = [{
                    x: 3,
                    y: 2,
                    color: 'red'
                }, {
                    x: 2,
                    y: 2,
                    color: 'blue'
                }, {
                    x: 1,
                    y: 2,
                    color: 'blue'
                }]

            }
            let arr = []
            Snake.prototype.a = function(foot) {
                // 获取食物坐标
                if (this.body[0].x == x && this.body[0].y == y) {
                    foot.init()
                    let last = this.body[this.body.length - 1]
                    this.body.push({
                        x: last.x,
                        y: last.y,
                        color: last.color
                    })
                }
                // 边界的判断 
                if (this.body[0].x == 40 || this.body[0].x == -1 || this.body[0].y == -1 || this.body[0].y == 25) {
                    alert('GAME OVER')
                    clearInterval(mmm)
                    return;
                }
                remove()
                for (let i = 0; i < this.body.length; i++) {
                    div = document.createElement('div')
                    map.appendChild(div)
                    div.style.width = this.width + 'px'
                    div.style.height = this.height + 'px'
                    div.style.position = 'absolute'
                    div.style.top = this.body[i].y * this.height + 'px'
                    div.style.left = this.body[i].x * this.width + 'px'
                    div.style.backgroundColor = this.body[i].color
                    arr.push(div)
                }
            };

            function remove() {
                // console.log(arr);
                for (let i = arr.length - 1; i >= 0; i--) {
                    arr[i].parentNode.removeChild(arr[i])
                }
                arr = []
            }
            Snake.prototype.move = function() {
                // 循环遍历蛇节 前一节的位置变为后一节的位置
                for (var i = this.body.length - 1; i > 0; i--) {
                    this.body[i].x = this.body[i - 1].x
                    this.body[i].y = this.body[i - 1].y
                }
                console.log(this.d);
                switch (this.d) {
                    case 'right':
                        this.body[0].x += 1
                        break;
                    case 'left':
                        this.body[0].x -= 1
                        break;
                    case 'bottom':
                        this.body[0].y += 1
                        break;
                    case 'top':
                        this.body[0].y -= 1
                        break;
                }
            }
            window.Snake = Snake
        })();
        // 游戏对象
        (function() {
            let that;

            function Game() {
                this.foot = new Foot()
                this.snake = new Snake()
                that = this
            }
            Game.prototype.b = function() {
                // 渲染蛇食物
                this.foot.init()
                this.snake.a()
                window.mmm = setInterval(function() {
                    // 左上右下 37 38 39 40 
                    document.onkeydown = function(e) {
                        console.log(e.keyCode);
                        switch (e.keyCode) {
                            case 37:
                                that.snake.d = 'left'
                                break;
                            case 38:
                                that.snake.d = 'top'
                                break;
                            case 39:
                                that.snake.d = 'right'
                                break;
                            case 40:
                                that.snake.d = 'bottom'
                                break;
                        }
                    }
                    that.snake.move()
                    that.snake.a(that.foot)
                }, 150)
            }
            window.Game = Game
        })();
        s1 = new Game()
        s1.b()
    </script>
</body>

</html>